<!DOCTYPE html>
<html lang="cn">

<head>

    <title>CodeMirror: Hello World Example</title>

    <script>
        function addContainer(mjx, doc) {
            // let e = mjx, t = doc;  
            const formulaType = mjx.display ? "block-equation" : "inline-equation";
            mjx.typesetRoot.className = formulaType;
            mjx.typesetRoot.setAttribute("data-formula", mjx.math);
            mjx.typesetRoot.setAttribute("data-formula-type", formulaType);
            // e.typesetRoot = t.adaptor.node("span", { class: n, style: "cursor:pointer" }, [e.typesetRoot])
        }
        MathJax = {
            // tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            tex: {
                inlineMath: [["$", "$"]],
                displayMath: [["$$", "$$"]],
                tags: "ams"
            },
            svg: { fontCache: "none" },

            // extensions: ["tex2jax.js", "TeX/AMSmath.js"],
            jax: ["input/TeX", "output/SVG"],
            svg: { fontCache: 'global' },
            options: {
                enableMenu: false,
                renderActions: {
                    addContainer: [190, (doc) => { for (const math of doc.math) { addContainer(math, doc) } }, addContainer]
                }
            }
        }; 
    </script>

    <script src="lib/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="lib/raphael.min.js"></script>
    <script src="lib/highlight.min.js"></script>
    <script src="lib/flowchart.min.js"></script>
    <script src="lib/underscore-min.js"></script>
    <script src="lib/sequence-diagram-min.js"></script>
    <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
    <!-- <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script> -->


    <style>
        * {
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #preview {
            width: 100%;
            height: 100%;
            overflow: scroll;
        }
    </style>
</head>

<body>
    <div id="preview">
    </div>
    <div id="test"></div>
</body>
<script>
    var preview = document.getElementById("preview")
    let fcCfg = {
        // 'x': 30,
        // 'y': 50,
        'line-width': 3,
        'maxWidth': 3,//ensures the flowcharts fits within a certian width
        'line-length': 50,
        'text-margin': 10,
        'font-size': 14,
        'font': 'normal',
        'font-family': 'Helvetica',
        'font-weight': 'normal',
        'font-color': 'black',
        'line-color': 'black',
        'element-color': 'black',
        'fill': 'white',
        'yes-text': 'yes',
        'no-text': 'no',
        'arrow-end': 'block',
        'scale': 1,
        'symbols': {
            'start': {
                'font-color': 'red',
                'element-color': 'green',
                'fill': 'yellow'
            },
            'end': {
                'class': 'end-element'
            }
        },
        'flowstate': {
            'past': { 'fill': '#CCCCCC', 'font-size': 12 },
            'current': { 'fill': 'yellow', 'font-color': 'red', 'font-weight': 'bold' },
            'future': { 'fill': '#FFFF99' },
            'request': { 'fill': 'blue' },
            'invalid': { 'fill': '#444444' },
            'approved': { 'fill': '#58C4A3', 'font-size': 12, 'yes-text': 'APPROVED', 'no-text': 'n/a' },
            'rejected': { 'fill': '#C45879', 'font-size': 12, 'yes-text': 'n/a', 'no-text': 'REJECTED' }
        }
    }
    function renderFlowchart() {
        $("#preview").find(".flowchart").each(function (idx, e) {
            var flowData = $(e).attr("flow-data")
            var chart = flowchart.parse(flowData);
            chart.drawSVG(e, fcCfg);
        });
        $("#preview").find(".sequence-diagram").each(function (idx, e) {
            var seqData = $(e).attr("seq-data")
            var diagram = Diagram.parse(seqData);
            diagram.drawSVG(e, { theme: 'simple' }); //{ theme: 'hand' }
        });
        // 2. 执行 mathjax 渲染
        MathJax.typeset();
    }

    function render(html) {
        preview.innerHTML = html;
        hljs.highlightAll();
        renderFlowchart();
    }
</script>

</html>